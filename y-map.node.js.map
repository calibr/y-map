{"version":3,"file":"y-map.node.js","sources":["src/y-map.js"],"sourcesContent":["/* global Y */\n\nexport default function extendYMap (Y) {\n  class YMap extends Y.utils.CustomType {\n    constructor (os, model, contents, opContents) {\n      super()\n      this._model = model.id\n      this._parent = null\n      this._deepEventHandler = new Y.utils.EventListenerHandler()\n      this.os = os\n      this.map = Y.utils.copyObject(model.map)\n      this.contents = contents\n      this.opContents = opContents\n      this.eventHandler = new Y.utils.EventHandler(op => {\n        var oldValue\n        // key is the name to use to access (op)content\n        var key = op.struct === 'Delete' ? op.key : op.parentSub\n\n        // compute oldValue\n        if (this.opContents[key] != null) {\n          oldValue = this.os.getType(this.opContents[key])\n        } else {\n          oldValue = this.contents[key]\n        }\n        // compute op event\n        if (op.struct === 'Insert') {\n          if (op.left === null && !Y.utils.compareIds(op.id, this.map[key])) {\n            var value\n            // TODO: what if op.deleted??? I partially handles this case here.. but need to send delete event instead. somehow related to #4\n            if (op.opContent != null) {\n              value = this.os.getType(op.opContent)\n              value._parent = this._model\n              delete this.contents[key]\n              if (op.deleted) {\n                delete this.opContents[key]\n              } else {\n                this.opContents[key] = op.opContent\n              }\n            } else {\n              value = op.content[0]\n              delete this.opContents[key]\n              if (op.deleted) {\n                delete this.contents[key]\n              } else {\n                this.contents[key] = op.content[0]\n              }\n            }\n            this.map[key] = op.id\n            if (oldValue === undefined) {\n              Y.utils.bubbleEvent(this, {\n                name: key,\n                object: this,\n                type: 'add',\n                value: value\n              })\n            } else {\n              Y.utils.bubbleEvent(this, {\n                name: key,\n                object: this,\n                oldValue: oldValue,\n                type: 'update',\n                value: value\n              })\n            }\n          }\n        } else if (op.struct === 'Delete') {\n          if (Y.utils.compareIds(this.map[key], op.target)) {\n            delete this.opContents[key]\n            delete this.contents[key]\n            Y.utils.bubbleEvent(this, {\n              name: key,\n              object: this,\n              oldValue: oldValue,\n              type: 'delete'\n            })\n          }\n        } else {\n          throw new Error('Unexpected Operation!')\n        }\n      })\n    }\n    _getPathToChild (childId) {\n      return Object.keys(this.opContents).find(key =>\n        Y.utils.compareIds(this.opContents[key], childId)\n      )\n    }\n    _destroy () {\n      this.eventHandler.destroy()\n      this.eventHandler = null\n      this.contents = null\n      this.opContents = null\n      this._model = null\n      this._parent = null\n      this.os = null\n      this.map = null\n    }\n    toJSON () {\n      var obj = {}\n      for (let key in this.contents) {\n        obj[key] = this.contents[key]\n      }\n      for (let key in this.opContents) {\n        let type = this.os.getType(this.opContents[key])\n        if (type.toJSON != null) {\n          obj[key] = type.toJSON()\n        } else if (type.toString != null) {\n          obj[key] = type.toString()\n        }\n      }\n      return obj\n    }\n    get (key) {\n      // return property.\n      // if property does not exist, return null\n      // if property is a type, return it\n      if (key == null || typeof key !== 'string') {\n        throw new Error('You must specify a key (as string)!')\n      }\n      if (this.opContents[key] == null) {\n        return this.contents[key]\n      } else {\n        return this.os.getType(this.opContents[key])\n      }\n    }\n    keys () {\n      return Object.keys(this.contents).concat(Object.keys(this.opContents))\n    }\n    keysPrimitives () {\n      return Object.keys(this.contents)\n    }\n    keysTypes () {\n      return Object.keys(this.opContents)\n    }\n    /*\n      If there is a primitive (not a custom type), then return it.\n      Returns all primitive values, if propertyName is specified!\n      Note: modifying the return value could result in inconsistencies!\n        -- so make sure to copy it first!\n    */\n    getPrimitive (key) {\n      if (key == null) {\n        return Y.utils.copyObject(this.contents)\n      } else if (typeof key !== 'string') {\n        throw new Error('Key is expected to be a string!')\n      } else {\n        return this.contents[key]\n      }\n    }\n    getType (key) {\n      if (key == null || typeof key !== 'string') {\n        throw new Error('You must specify a key (as string)!')\n      } else if (this.opContents[key] != null) {\n        return this.os.getType(this.opContents[key])\n      } else {\n        return null\n      }\n    }\n    delete (key) {\n      var right = this.map[key]\n      if (right != null) {\n        var del = {\n          target: right,\n          struct: 'Delete'\n        }\n        var eventHandler = this.eventHandler\n        var modDel = Y.utils.copyObject(del)\n        modDel.key = key\n        this.os.requestTransaction(function () {\n          eventHandler.awaitOps(this, this.applyCreatedOperations, [[del]])\n        })\n        // always remember to do that after this.os.requestTransaction\n        // (otherwise values might contain a undefined reference to type)\n        eventHandler.awaitAndPrematurelyCall([modDel])\n      }\n    }\n    set (key, value) {\n      // set property.\n      // if property is a type, return it\n      // if not, apply immediately on this type an call event\n\n      var right = this.map[key] || null\n      var insert = {\n        id: this.os.getNextOpId(1),\n        left: null,\n        right: right,\n        origin: null,\n        parent: this._model,\n        parentSub: key,\n        struct: 'Insert'\n      }\n      var eventHandler = this.eventHandler\n      var typeDefinition = Y.utils.isTypeDefinition(value)\n      if (typeDefinition !== false) {\n        var type = this.os.createType(typeDefinition)\n        insert.opContent = type._model\n        // construct a new type\n        this.os.requestTransaction(function () {\n          eventHandler.awaitOps(this, this.applyCreatedOperations, [[insert]])\n        })\n        // always remember to do that after this.os.requestTransaction\n        // (otherwise values might contain a undefined reference to type)\n        eventHandler.awaitAndPrematurelyCall([insert])\n        return type\n      } else {\n        insert.content = [value]\n        this.os.requestTransaction(function () {\n          eventHandler.awaitOps(this, this.applyCreatedOperations, [[insert]])\n        })\n        // always remember to do that after this.os.requestTransaction\n        // (otherwise values might contain a undefined reference to type)\n        eventHandler.awaitAndPrematurelyCall([insert])\n        return value\n      }\n    }\n    observe (f) {\n      this.eventHandler.addEventListener(f)\n    }\n    observeDeep (f) {\n      this._deepEventHandler.addEventListener(f)\n    }\n    unobserve (f) {\n      this.eventHandler.removeEventListener(f)\n    }\n    unobserveDeep (f) {\n      this._deepEventHandler.removeEventListener(f)\n    }\n    /*\n      Observe a path.\n\n      E.g.\n      ```\n      o.set('textarea', Y.TextBind)\n      o.observePath(['textarea'], function(t){\n        // is called whenever textarea is replaced\n        t.bind(textarea)\n      })\n\n      returns a function that removes the observer from the path.\n    */\n    observePath (path, f) {\n      var self = this\n      var propertyName\n      function observeProperty (event) {\n        // call f whenever path changes\n        if (event.name === propertyName) {\n          // call this also for delete events!\n          f(self.get(propertyName))\n        }\n      }\n\n      if (path.length < 1) {\n        f(this)\n        return function () {}\n      } else if (path.length === 1) {\n        propertyName = path[0]\n        f(self.get(propertyName))\n        this.observe(observeProperty)\n        return function () {\n          self.unobserve(f)\n        }\n      } else {\n        var deleteChildObservers\n        var resetObserverPath = function () {\n          var map = self.get(path[0])\n          if (!(map instanceof YMap)) {\n            // its either not defined or a primitive value / not a map\n            map = self.set(path[0], Y.Map)\n          }\n          deleteChildObservers = map.observePath(path.slice(1), f)\n        }\n        var observer = function (event) {\n          if (event.name === path[0]) {\n            if (deleteChildObservers != null) {\n              deleteChildObservers()\n            }\n            if (event.type === 'add' || event.type === 'update') {\n              resetObserverPath()\n            }\n            // TODO: what about the delete events?\n          }\n        }\n        self.observe(observer)\n        resetObserverPath()\n        // returns a function that deletes all the child observers\n        // and how to unobserve the observe from this object\n        return function () {\n          if (deleteChildObservers != null) {\n            deleteChildObservers()\n          }\n          self.unobserve(observer)\n        }\n      }\n    }\n    _changed (transaction, op) {\n      if (op.struct === 'Delete') {\n        if (op.key == null) {\n          var target = transaction.getOperation(op.target)\n          op.key = target.parentSub\n        }\n      } else if (op.opContent != null) {\n        transaction.store.initType.call(transaction, op.opContent)\n      }\n      this.eventHandler.receivedOp(op)\n    }\n  }\n  Y.extend('Map', new Y.utils.CustomTypeDefinition({\n    name: 'Map',\n    class: YMap,\n    struct: 'Map',\n    initType: function YMapInitializer (os, model) {\n      var contents = {}\n      var opContents = {}\n      var map = model.map\n      for (var name in map) {\n        var op = this.getOperation(map[name])\n        if (op.deleted) continue\n        if (op.opContent != null) {\n          opContents[name] = op.opContent\n          var type = this.store.initType.call(this, op.opContent)\n          type._parent = model.id\n        } else {\n          contents[name] = op.content[0]\n        }\n      }\n      return new YMap(os, model, contents, opContents)\n    },\n    createType: function YMapCreator (os, model) {\n      return new YMap(os, model, {}, {})\n    }\n  }))\n}\n\nif (typeof Y !== 'undefined') {\n  extendYMap(Y)\n}\n"],"names":[],"mappings":"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"}